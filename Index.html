<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Actuarial Guessing Dept ç²¾é¸ä¼°æ­Œéƒ¨</title>
    <style>
        :root { --pricing-pink: #ff007b; --actuary-blue: #00e5ff; --bg: #0d0d0d; }
        body { font-family: sans-serif; background-color: var(--bg); color: white; text-align: center; padding: 5px; margin: 0; overflow-x: hidden; }
        
        .screen { display: none; padding: 5px; min-height: 90vh; }
        .active { display: block; }

        .main-header { color: white; font-size: 22px; margin-top: 15px; margin-bottom: 15px; font-weight: bold; width: 100%; }

        /* Scoreboard */
        .timer-box { font-size: 32px; color: #666; font-family: monospace; font-weight: bold; width: 80px; display: flex; align-items: center; justify-content: center; }
        .timer-box.danger { color: #ff4757; text-shadow: 0 0 10px #ff4757; font-size: 48px; }
        .container { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 10px; }
        .team-box { background: #1a1a1a; padding: 10px; border-radius: 15px; width: 35%; border: 1px solid #333; }
        .team-name { font-size: 14px; margin-bottom: 5px; outline: none; border-bottom: 1px dashed #444; }
        .score { font-size: 45px; font-weight: bold; margin: 2px 0; }
        
        button { cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; }
        .btn-plus { background: var(--pricing-pink); color: white; width: 60px; height: 40px; font-size: 24px; }
        .btn-minus { background: #333; color: #888; width: 40px; height: 30px; font-size: 12px; margin-top: 4px; }

        /* Round 1 Styles */
        .game-area { position: relative; width: 100%; max-width: 400px; aspect-ratio: 16/9; margin: 10px auto; border-radius: 12px; overflow: hidden; border: 1px solid #444; background: #000; }
        #black-shield { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; pointer-events: none; }
        #status-msg { font-size: 22px; color: #ff4757; font-weight: bold; }
        #player-target { width: 100%; height: 100%; }
        .card { background: white; color: #333; padding: 15px; border-radius: 15px; max-width: 400px; margin: 10px auto; }
        .main-btn { background: #e74c3c; color: white; width: 100%; padding: 15px; font-size: 18px; margin-bottom: 10px; border-radius: 12px; }
        .sub-btn { background: #555; color: white; flex: 1; padding: 10px; font-size: 12px; }
        .rev-btn { background: #28a745; color: white; flex: 1; padding: 10px; font-size: 12px; }
        .ans-box { background: #f0f0f0; border: 1px solid #ddd; margin-top: 5px; padding: 8px; border-radius: 8px; font-weight: bold; visibility: hidden; min-height: 20px; font-size: 14px; }
        #box-lyrics { color: #e74c3c; min-height: 85px; display: flex; align-items: center; justify-content: center; font-size: 20px; padding: 15px; border: 2px solid #ff4757; line-height: 1.4; }
        #blanks { color: #28a745; font-size: 18px; font-weight: bold; margin: 15px 0; display: none; line-height: 1.6; }

        /* Round 2 & 3 Small Button Style */
        .small-round-btn { padding: 6px 12px; font-size: 13px; border-radius: 6px; margin: 4px; }

        /* Rules Overlay */
        .rules-screen { background: #1a1a1a; padding: 30px; border-radius: 20px; margin: 20px auto; max-width: 350px; border: 2px solid var(--pricing-pink); }
        .rules-text { text-align: left; line-height: 1.8; color: #ccc; margin-bottom: 25px; font-size: 15px; }

        /* Navigation */
        .home-card { background: #1a1a1a; padding: 25px; border-radius: 20px; border: 1px solid #333; margin: 15px auto; max-width: 350px; cursor: pointer; }
        .back-btn-r1 { background: #444; color: white; width: 100%; padding: 10px; border-radius: 12px; margin-top: 10px; font-size: 14px; }
    </style>
</head>
<body>

    <div id="home-screen" class="screen active">
        <div class="main-header" style="margin-top: 50px; font-size: 26px; color: var(--actuary-blue);">
            Actuarial Guessing Dept <br> ç²¾é¸ä¼°æ­Œéƒ¨
        </div>
        <div class="home-card" onclick="showRules(1)"><h2>Round 1</h2><p>ä¼°æ­Œä»”</p></div>
        <div class="home-card" onclick="showRules(2)"><h2>Round 2</h2><p>æƒ…å¢ƒé¡Œ</p></div>
        <div class="home-card" onclick="showRules(3)"><h2>Round 3</h2><p>å”± Key Word</p></div>
    </div>

    <div id="rules-overlay" class="screen">
        <div class="rules-screen">
            <h2 id="rule-title" style="color:var(--pricing-pink)">è¦å‰‡</h2>
            <div class="rules-text" id="rule-content"></div>
            <button class="main-btn" id="rule-start-btn" onclick="startGame()" style="background:var(--pricing-pink); border:2px solid white;">PRESS START TO START</button>
        </div>
    </div>

    <div id="game-ui" style="display:none;">
        <div class="main-header">Actuarial Guessing Dept</div>
        <div class="container">
            <div class="team-box" style="border-color: var(--pricing-pink);">
                <div class="team-name" contenteditable="true" style="color: var(--pricing-pink);">TEAM A</div>
                <div id="scoreA" class="score" style="color: var(--pricing-pink);">0</div>
                <button class="btn-plus" onclick="changeScore('scoreA', 1)">+</button><br>
                <button class="btn-minus" onclick="changeScore('scoreA', -1)">-1</button>
            </div>
            <div class="timer-box" id="timer">VS</div>
            <div class="team-box" style="border-color: var(--actuary-blue);">
                <div class="team-name" contenteditable="true" style="color: var(--actuary-blue);">TEAM B</div>
                <div id="scoreB" class="score" style="color: var(--actuary-blue);">0</div>
                <button class="btn-plus" onclick="changeScore('scoreB', 1)" style="background: var(--actuary-blue);">+</button><br>
                <button class="btn-minus" onclick="changeScore('scoreB', -1)">-1</button>
            </div>
        </div>

        <div id="round1-content" style="display:none;">
            <div class="game-area">
                <div id="black-shield"><div id="status-msg">Loading...</div></div>
                <div id="player-target"></div>
            </div>
            <div class="card">
                <button class="main-btn" onclick="syncStart()">â³ Click to Start</button>
                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <button class="sub-btn" onclick="replayLast()">ğŸ”„ Replay Last 5s</button>
                    <button class="sub-btn" style="background:#333;" onclick="stopSong()">â¹ STOP</button>
                </div>
                <div id="blanks">
                    <div style="color: #666; font-size: 14px; text-decoration: underline; margin-bottom: 8px;">ä¸‹ä¸€å¥ï¼š</div>
                    <div id="red-dots-line" style="letter-spacing: 2px;"></div>
                </div>
                <div style="display:flex; justify-content:space-between; gap:5px;">
                    <button class="rev-btn" onclick="rev('singer')">1. æ­Œæ‰‹</button>
                    <button class="rev-btn" onclick="rev('title')">2. æ­Œå</button>
                    <button class="rev-btn" onclick="rev('lyrics')">3. ä¸‹ä¸€å¥</button>
                </div>
                <div id="box-singer" class="ans-box">æ­Œæ‰‹: ---</div>
                <div id="box-title" class="ans-box">æ­Œå: ---</div>
                <div id="box-lyrics" class="ans-box"></div>
                <button class="main-btn" style="background:#000; margin-top:15px;" onclick="nextSong()">NEXT SONG â”</button>
                <button class="back-btn-r1" onclick="goHome()">BACK TO MENU</button>
                <div id="round-info" style="font-size:12px; color:#999; margin-top:5px;">Song: 1 / 32</div>
            </div>
        </div>

        <div id="generic-content" style="display:none;">
            <div style="font-size: 28px; color: var(--pricing-pink); font-weight: bold; margin: 40px 0; min-height: 100px; display: flex; align-items: center; justify-content: center; padding: 20px; border: 2px dashed #333; border-radius: 15px;" id="topic-text">ä¸»é¡Œ</div>
            <div style="font-size: 80px; font-family: monospace; color: #ff4757; margin: 20px 0; font-weight: bold;" id="timer-display">10</div>
            <div style="margin-top: 20px;">
                <button class="small-round-btn" style="background:#28a745; color:white;" onclick="start10sTimer()">START TIMER</button>
                <button class="small-round-btn" style="background:#555; color:white;" onclick="nextTopic()">NEXT ITEM</button>
            </div>
            <button class="small-round-btn" style="background:#444; color:white; margin-top:50px; opacity: 0.7;" onclick="goHome()">BACK TO MENU</button>
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player, logicInt, idx = 0, currentRound = 0;
        
        const masterSongs = [
            {id:"URUIcYDq3_I", s:145, d:15, singer:"é™³å¥•è¿…", title:"é™€é£›è¼ª", lyrics:"ç§’é€ŸğŸ”´ğŸ”´ğŸ”´ğŸ”´ è€Œçš®è†šğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"ç§’é€Ÿæ‰å¾—ç·Šäº† è€Œçš®è†šç«Ÿå·å·é¬†äº†"},
            {id:"scHDBckJXv4", s:135, d:15, singer:"å¤å·¨åŸº", title:"å¿…æ®ºæŠ€", lyrics:"æ±‚ä½ ğŸ”´ğŸ”´ éŒ¯éæˆ‘ ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"æ±‚ä½ åˆ¥èªª éŒ¯éæˆ‘ å…¶å¯¦äº¦æ„›æˆ‘"},
            {id:"5wJFZBulzsI", s:131, d:14, singer:"å¼µæ•¬è»’", title:"æ«»èŠ±æ¨¹ä¸‹", lyrics:"äººç½®èº«ğŸ”´ğŸ”´ğŸ”´ğŸ”´ æŠ•å…¥ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"äººç½®èº«é€™å¤§æ™‚ä»£ æŠ•å…¥å¹¾ç•ªç«¶æŠ€è³½"},
            {id:"E9BgBB0JQ8E", s:128, d:20, singer:"å´ç”°", title:"å‘½ç¡¬", lyrics:"ç­‰ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´æ¯æ­»", ans:"ç­‰èŠæ£˜æ»¿é€”å…¨æ¯æ­»"},
            {id:"WJaufugjeSQ", s:86, d:26, singer:"æ¥Šåƒå¬…", title:"å°åŸå¤§äº‹", lyrics:"ä½ ä½•ä»¥ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"ä½ ä½•ä»¥é›™çœ¼å¥½åƒæµæ·š"},
            {id:"cPKfUWDmNbo", s:62, d:20, singer:"Twins", title:"ä¸‹ä¸€ç«™å¤©å", lyrics:"é›£åŠğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ğŸ”´ğŸ”´ğŸ”´ğŸ”´åœ°å”±", ans:"é›£åŠä»–åœ¨æˆ‘èº«é‚Š è²¼åˆ‡åœ°å”±"},
            {id:"onZjMJq4LhU", s:98, d:20, singer:"å®¹ç¥–å…’", title:"æˆ‘çš„é©•å‚²", lyrics:"å› ä½ ğŸ”´ğŸ”´ ğŸ”´ğŸ”´ğŸ”´", ans:"å› ä½ å‰µæ›´æ„‰å¿«"},
            {id:"v04DzjzSb5w", s:64, d:14, singer:"ç›§å·§éŸ³", title:"å¥½å¿ƒåˆ†æ‰‹", lyrics:"è‹¥æ³¨å®šğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ä¸å¦‚ğŸ”´ğŸ”´ğŸ”´ğŸ”´å‰²ç ´", ans:"è‹¥æ³¨å®šæœ‰ä¸€é»è‹¦æ¥š ä¸å¦‚è‡ªå·±è¦ªæ‰‹å‰²ç ´"},
            {id:"qu_FSptjRic", s:68, d:20, singer:"Beyond", title:"æµ·é—Šå¤©ç©º", lyrics:"å“ªğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ä½ ğŸ”´ğŸ”´æˆ‘", ans:"å“ªæœƒæ€•æœ‰ä¸€å¤©åªä½ å…±æˆ‘"},
            {id:"8dqdPHuFgfI", s:147, d:14, singer:"è˜‡æ°¸åº·", title:"è¶Šå»è¶Šå‚·å¿ƒ", lyrics:"ä½•å¿…ğŸ”´ğŸ”´ ğŸ”´ğŸ”´", ans:"ä½•å¿…è¿½å•é è¿‘"},
            {id:"JNocLV9gXuw", s:66, d:11, singer:"å‘¨åœ‹è³¢", title:"åœ°ä¸‹è¡—", lyrics:"ğŸ”´ğŸ”´å€‘ğŸ”´ğŸ”´åœ°ğŸ”´ğŸ”´", ans:"é€”äººå€‘ç›¸ç¹¼åœ°å›å®¶"},
            {id:"UlkToY0QfaU", s:38, d:20, singer:"éº¥æµšé¾", title:"æœ‰äºº", lyrics:"å¦‚ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´åˆ°", ans:"å¦‚æ²’æœ‰ä¿¡å¿ƒæ¥å—åˆ°"},
            {id:"VuvpCOL1hLQ", s:57, d:21, singer:"è¬éœ†é‹’", title:"å£ç¿’æ…£", lyrics:"è€Œé™½å…‰ğŸ”´ğŸ”´ ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ç•™ä½ä¸€æŠŠé›¨å‚˜", ans:"è€Œé™½å…‰ä¸€å‡º ç«Ÿä¸€å»ä¸è¿” ç•™ä½ä¸€æŠŠé›¨å‚˜"},
            {id:"yd_t2VRZMhU", s:1, d:25, singer:"é„­ä¸­åŸº", title:"æœ‰ç¨®", lyrics:"æœªå¿…è¦åšğŸ”´ğŸ”´ ç¨±éœ¸ğŸ”´ğŸ”´ æ˜¯æˆ‘ğŸ”´ğŸ”´ğŸ”´", ans:"æœªå¿…è¦åšå¼·è€… ç¨±éœ¸æœ€å¼· æ˜¯æˆ‘ä¸æ€•ç—›"},
            {id:"IDywqSyQ3Mc", s:154, d:16, singer:"é„§éº—æ¬£", title:"é›»ç‡ˆè†½", lyrics:"è¦ğŸ”´ğŸ”´ğŸ”´åˆæŠ˜ğŸ”´", ans:"è¦èµ°çš„ä¸€å‰åˆæŠ˜è¿”"},
            {id:"CJ4fKSmOf3U", s:48, d:18, singer:"è˜‡æ°¸åº·", title:"é‚£èª°", lyrics:"æ·šç–Šæ·š ğŸ”´ğŸ”´ğŸ”´ æ¼¸è«è¾¨ ğŸ”´ğŸ”´", ans:"æ·šå æ·š é¢¨ä¸€å¹ æ¼¸è«è¾¨ é‚£~èª°"},
            {id:"1WLFhjQ0cDc", s:66, d:26, singer:"ç‹å‚‘", title:"ä¸æµªæ¼«ç½ªå", lyrics:"å¾ä¾†ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´å‹•è½", ans:"å¾ä¾†æœªå¯Ÿè¦ºæˆ‘èªæ°£å‹•è½"},
            {id:"f5NzXpC8tdU", s:52, d:12, singer:"å§œæ¿¤", title:"è’™è‘—å˜´èªªæ„›ä½ ", lyrics:"å¤©çµ¦æˆ‘ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ç¬‘è‘—å»ğŸ”´ğŸ”´", ans:"å¤©çµ¦æˆ‘è²§ç—…å›°è‹¦ ç¬‘è‘—å»åƒè‹¦"},
            {id:"YZPFbnk_RS0", s:225, d:19, singer:"MCå¼µå¤©è³¦", title:"è¨˜æ†¶æ£‰", lyrics:"æ˜å¤©ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´è¦", ans:"æ˜å¤©è¦‹ä¹Ÿæœ€å¥½ä¸è¦"},
            {id:"sg8V5BLMEhE", s:115, d:19, singer:"Dear Jane", title:"éŠ€æ²³ä¿®ç†å“¡", lyrics:"é€™ç¨®ğŸ”´ğŸ”´éğŸ”´ğŸ”´", ans:"é€™ç¨®å …å£¯éå …å£¯"},
            {id:"qWhavDVsMRc", s:133, d:11, singer:"æ—å®¶è¬™", title:"ä¸€äººä¹‹å¢ƒ", lyrics:"æ²‰é»˜ğŸ”´ğŸ”´ æœŸå¾…ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"æ²‰é»˜çœ‹æ˜Ÿ æœŸå¾…æ—¥å…‰ç‰½é ˜"},
            {id:"7FPL4DRizgk", s:188, d:13, singer:"Edan å‘‚çˆµå®‰", title:"Eå…ˆç”Ÿé€£ç’°ä¸å¹¸äº‹ä»¶", lyrics:"æ¼‚äº®é ç‡¦ğŸ”´é ä½ æˆ–æœƒğŸ”´ğŸ”´ æˆ‘ğŸ”´", ans:"æ¼‚äº®é ç‡¦çˆ›é ä½ æˆ–æœƒå–œæ­¡ æˆ‘æ‚¶"},
            {id:"Rp4iHpTvBY8", s:166, d:15, singer:"æ´ªå˜‰è±ª", title:"é»‘ç»ç’ƒ", lyrics:"ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´å…¬é–‹", ans:"æ¥å»æ¥åˆ°ç„¡æ³•å…¬é–‹"},
            {id:"vER4DPlhXXI", s:90, d:14, singer:"é™³è•¾", title:"å‡¡æ˜Ÿ", lyrics:"æˆæ•—èˆ‡å¦ğŸ”´ğŸ”´ğŸ”´ğŸ”´çœ‹ å¾ä¾†æ²’ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"æˆæ•—èˆ‡å¦çœ‹æˆ‘æ˜¯æ€éº¼çœ‹ å¾ä¾†æ²’æ¨™æº–ç­”æ¡ˆ"},
            {id:"falq0Gr3rc0", s:161, d:16, singer:"Gareth.T", title:"ç”¨èƒŒè„Šå”±æƒ…æ­Œ", lyrics:"æµäº¡ğŸ”´ğŸ”´çœ¼å‰ğŸ”´ğŸ”´ æ°¸æ†åœ¨è½‰ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"æµäº¡è’é‡çœ¼å‰éƒ½æœ‰ æ°¸æ†åœ¨è½‰é‚£ç¾£æœ¨é¦¬"},
            {id:"y9ntnHvD4tQ", s:135, d:19, singer:"å¼µæ•¬è»’", title:"éš±å½¢éŠæ¨‚å ´", lyrics:"ç³Šå¡—ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ä¸éœ€è¦ğŸ”´ğŸ”´ğŸ”´", ans:"ç³Šå¡—åœ°é—–å¤©åœ° ä¸éœ€è¦ä¸‰å¹…è¢«"},
            {id:"jrP24ZSYHts", s:126, d:12, singer:"æ—å®¶è¬™", title:"ç¥å¥‡çš„ç³Šå¡—é­”è—¥", lyrics:"ç­‰åˆ°ğŸ”´ğŸ”´é‚£å¤© ğŸ”´ğŸ”´æˆ‘æœƒğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"ç­‰åˆ°æ”¾æ™´çš„é‚£å¤© ä¹Ÿè¨±æˆ‘æœƒæ¯”è¼ƒå¥½ä¸€é»"},
            {id:"DYptgVvkVLQ", s:104, d:15, singer:"å‘¨æ°å€«", title:"æ™´å¤©", lyrics:"ç­‰åˆ°ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ä¹Ÿè¨±æˆ‘æœƒğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"ç­‰åˆ°æ”¾æ™´çš„é‚£å¤© ä¹Ÿè¨±æˆ‘æœƒæ¯”è¼ƒå¥½ä¸€é»"},
            {id:"bu7nU9Mhpyo", s:43, d:32, singer:"å‘¨æ°å€«", title:"å‘Šç™½æ°£çƒ", lyrics:"è¦ªæ„›çš„ğŸ”´ğŸ”´ğŸ”´ ä½ çš„ğŸ”´ğŸ”´ åœ¨èªªæˆ‘ğŸ”´ğŸ”´", ans:"è¦ªæ„›çš„åˆ¥ä»»æ€§ ä½ çš„çœ¼ç› åœ¨èªªæˆ‘é¡˜æ„"},
            {id:"T4SimnaiktU", s:65, d:18, singer:"G.E.M.", title:"å…‰å¹´ä¹‹å¤–", lyrics:"æ²’æœ‰ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´è¦", ans:"æ²’æœ‰ä½ æ ¹æœ¬ä¸é‡è¦"},
            {id:"6aosRlnxg9I", s:129, d:24, singer:"ä»»è³¢é½Š.", title:"å°é¢çš„å¥³å­©çœ‹éä¾†", lyrics:"åŸä¾†ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"åŸä¾†æ¯å€‹å¥³å­©éƒ½ä¸ç°¡å–®"},
            {id:"GtDRcXtDg-4", s:89, d:20, singer:"äº”æœˆå¤©", title:"çªç„¶å¥½æƒ³ä½ ", lyrics:"çªç„¶ğŸ”´ğŸ”´ğŸ”´ğŸ”´ç›", ans:"çªç„¶æ¨¡ç³Šçš„çœ¼ç›"}
        ];

        const r2Topics = ["å¤±æˆ€æœƒè½çš„æ­Œ", "é—œæ–¼è½é›¨çš„æ­Œ", "å……æ»¿æ­£èƒ½é‡çš„æ­Œ", "å…µæ­Œ", "é—œæ–¼æ—…è¡Œçš„æ­Œ"];
        const r3Keywords = ["æ­Œè©æœ‰äººé«”éƒ¨ä½ (æ‰‹/çœ¼/å’€...)", "é—œæ–¼é¡è‰² (ç´…/é»‘/ç™½...)", "æ­Œè©æœ‰æ„›å­—", "é—œæ–¼æ™‚é–“ (ç§’/åˆ†/é˜)", "é—œæ–¼å¤©æ°£ (æ™´/é›¨/é›²)"];
        let topicIdx = 0;

        function showRules(r) {
            currentRound = r;
            document.getElementById('home-screen').classList.remove('active');
            document.getElementById('rules-overlay').classList.add('active');
            const rules = [
                "",
                "1. è½ 10-20 ç§’æ­Œæ›²ç‰‡æ®µ<br>2. çŒœå‡ºæ­Œæ‰‹ã€æ­Œåã€ä¸‹ä¸€å¥æ­Œè©<br>3. æ¯ä¸­ä¸€é …å¾— 1 åˆ†",
                "1. æŠ½å‡ºä¸€å€‹æƒ…å¢ƒä¸»é¡Œ<br>2. å…©éšŠè¼ªæµå”±å‡ºç¬¦åˆä¸»é¡Œçš„æ­Œ<br>3. å¿…é ˆå”±å‡ºæœ€å°‘ä¸€å¥æ­Œè©<br>4. 10ç§’å…§æ¥ä¸åˆ°å‰‡è¼¸",
                "1. æŠ½å‡ºä¸€å€‹æŒ‡å®šçš„é—œéµå­—<br>2. å”±å‡ºçš„æ­Œè©ä¸­å¿…é ˆåŒ…å«è©²å­—<br>3. å…©éšŠäº¤æ›¿é€²è¡Œ<br>4. 10ç§’å…§æ¥ä¸åˆ°å‰‡è¼¸"
            ];
            document.getElementById('rule-title').innerText = "Round " + r + " è¦å‰‡";
            document.getElementById('rule-content').innerHTML = rules[r];
        }

        function startGame() {
            document.getElementById('rules-overlay').classList.remove('active');
            document.getElementById('game-ui').style.display = 'block';
            if(currentRound === 1) {
                document.getElementById('round1-content').style.display = 'block';
                document.getElementById('generic-content').style.display = 'none';
                idx = 0; 
                loadVideo();
            } else {
                document.getElementById('round1-content').style.display = 'none';
                document.getElementById('generic-content').style.display = 'block';
                topicIdx = 0; updateTopicDisplay();
            }
        }

        function goHome() {
            if(player) player.pauseVideo();
            clearInterval(logicInt);
            document.getElementById('home-screen').classList.add('active');
            document.getElementById('game-ui').style.display = 'none';
        }

        /* --- Round 1 Logic --- */
        function onYouTubeIframeAPIReady() {}

        function loadVideo() {
            if(player) player.destroy();
            document.getElementById('round-info').innerText = `Song: ${idx + 1} / 32`;
            document.getElementById('black-shield').style.display = 'flex'; // è¼‰å…¥æ–°æ­Œæ™‚ç¢ºä¿é®ç½©å­˜åœ¨
            player = new YT.Player('player-target', {
                height: '100%', width: '100%', videoId: masterSongs[idx].id,
                playerVars: { 'autoplay': 0, 'controls': 0, 'playsinline': 1, 'start': masterSongs[idx].s },
                events: { 'onReady': (e) => { 
                    e.target.mute(); e.target.playVideo();
                    setTimeout(() => { e.target.pauseVideo(); e.target.unMute(); document.getElementById('status-msg').innerText = "Ready!"; }, 800);
                }}
            });
        }

        function syncStart() {
            player.seekTo(masterSongs[idx].s, true); 
            player.playVideo();
            document.getElementById('status-msg').innerText = "PLAYING...";
            document.getElementById('black-shield').style.display = 'flex'; // æ’­æ”¾æ™‚ç¶­æŒé®ç½©
            document.getElementById('blanks').style.display = 'none';
            let elapsed = 0; let duration = masterSongs[idx].d;
            clearInterval(logicInt);
            logicInt = setInterval(() => {
                elapsed++;
                let remaining = duration - elapsed;
                if(remaining <= 5 && remaining > 0) {
                    document.getElementById('timer').innerText = remaining;
                    document.getElementById('timer').classList.add('danger');
                }
                if(elapsed >= duration) { clearInterval(logicInt); finishClip(); }
            }, 1000);
        }

        function finishClip() {
            player.pauseVideo(); 
            document.getElementById('timer').innerText = "STOP";
            document.getElementById('timer').classList.remove('danger');
            document.getElementById('status-msg').innerText = "è«‹ä½œç­”";
            document.getElementById('red-dots-line').innerText = masterSongs[idx].lyrics;
            document.getElementById('blanks').style.display = 'block';
        }

        function rev(type) {
            const prefix = {singer: 'æ­Œæ‰‹: ', title: 'æ­Œå: ', lyrics: ''};
            const val = type === 'lyrics' ? masterSongs[idx].ans : masterSongs[idx][type];
            document.getElementById('box-' + type).innerText = prefix[type] + val;
            document.getElementById('box-' + type).style.visibility = 'visible';
            
            // ä¿®æ”¹ï¼šåªæœ‰ç•¶é»æ“Šã€Œä¸‹ä¸€å¥ã€æ™‚ï¼Œé®ç½©æ¶ˆå¤±ä¸¦ç¹¼çºŒæ’­æ”¾å½±ç‰‡
            if(type === 'lyrics') {
                document.getElementById('black-shield').style.display = 'none';
                player.playVideo();
            }
        }

        function nextSong() {
            idx++; 
            if(idx >= masterSongs.length) { alert("Complete!"); goHome(); return; }
            document.getElementById('black-shield').style.display = 'flex';
            document.getElementById('blanks').style.display = 'none';
            ['singer','title','lyrics'].forEach(t => document.getElementById('box-'+t).style.visibility='hidden');
            document.getElementById('timer').innerText = "VS"; 
            loadVideo();
        }

        /* --- Round 2 & 3 Logic --- */
        function updateTopicDisplay() {
            const list = (currentRound === 2) ? r2Topics : r3Keywords;
            document.getElementById('topic-text').innerText = (currentRound === 2 ? "ä¸»é¡Œï¼š" : "é—œéµå­—ï¼š") + list[topicIdx];
            document.getElementById('timer-display').innerText = "10";
            document.getElementById('timer-display').style.color = "#ff4757";
        }

        function start10sTimer() {
            let count = 10;
            document.getElementById('timer-display').innerText = count;
            clearInterval(logicInt);
            logicInt = setInterval(() => {
                count--; document.getElementById('timer-display').innerText = count;
                if(count <= 0) { clearInterval(logicInt); document.getElementById('timer-display').innerText = "OUT"; }
            }, 1000);
        }

        function nextTopic() {
            const list = (currentRound === 2) ? r2Topics : r3Keywords;
            topicIdx = (topicIdx + 1) % list.length;
            updateTopicDisplay(); clearInterval(logicInt);
        }

        function changeScore(id, amt) { 
            let el = document.getElementById(id); let s = parseInt(el.innerText) + amt; el.innerText = s < 0 ? 0 : s; 
        }

        function stopSong() { if(player) player.pauseVideo(); clearInterval(logicInt); }
        function replayLast() { if(player) { player.seekTo(masterSongs[idx].s + masterSongs[idx].d - 5); player.playVideo(); setTimeout(()=>player.pauseVideo(), 5000); } }
    </script>
</body>
</html>
